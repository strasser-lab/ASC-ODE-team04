{"version":2,"kind":"Article","sha256":"b99d9af4a53d871a588ee600595de7fb064da2378c7b378cc2d072a28a1dccc7","slug":"crank-nicolson","location":"/Crank_Nicolson.md","dependencies":[],"frontmatter":{"title":"Crank–Nicolson Method","content_includes_title":false,"authors":[{"nameParsed":{"literal":"Strasser Christian","given":"Strasser","family":"Christian"},"name":"Strasser Christian","id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"HUNG YI-CHENG","given":"HUNG","family":"YI-CHENG"},"name":"HUNG YI-CHENG","id":"contributors-myst-generated-uid-1"},{"nameParsed":{"literal":"Fernando Waduge Sachindra Priyageeth","given":"Fernando Waduge Sachindra","family":"Priyageeth"},"name":"Fernando Waduge Sachindra Priyageeth","id":"contributors-myst-generated-uid-2"},{"nameParsed":{"literal":"Csikós Máté László","given":"Csikós Máté","family":"László"},"name":"Csikós Máté László","id":"contributors-myst-generated-uid-3"}],"github":"https://github.com/JSchoeberl/IntroSC.git","copyright":"2025","source_url":"https://github.com/JSchoeberl/IntroSC.git/blob/main/docs/Crank_Nicolson.md","edit_url":"https://github.com/JSchoeberl/IntroSC.git/edit/main/docs/Crank_Nicolson.md","thumbnail":"/ASC-ODE-team04/build/mass_spring_steps_50-e12c9c2778af12594bd2ac67da38201d.png","exports":[{"format":"md","filename":"Crank_Nicolson.md","url":"/ASC-ODE-team04/build/Crank_Nicolson-083e10a593147a4e683c9de333bcac6c.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Exercise 17.4.1","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"hQEFQw3I5C"}],"identifier":"exercise-17-4-1","label":"Exercise 17.4.1","html_id":"exercise-17-4-1","implicit":true,"key":"OawJdolNFr"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"In this exercise we had to:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Un0VRxtwk7"}],"key":"pKpgjVzKkT"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":6,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"implement the Crank–Nicolson method","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"mfjac9jQuO"}],"key":"Pwn8dGoHXW"}],"key":"yJ5EulYktz"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"compare the three methods to each other","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"JS20BAFpJD"}],"key":"xMjBUjqIsK"}],"key":"G4sgL9bL9R"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"use the three methods to solve an electronic network","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"ESk1nGYqlk"}],"key":"TM5fqey8HN"}],"key":"FH8i7CK2F9"}],"key":"n4olcdy5TH"},{"type":"heading","depth":2,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Crank–Nicolson","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"O5Eq9NYzhT"}],"identifier":"crank-nicolson","label":"Crank–Nicolson","html_id":"crank-nicolson","implicit":true,"key":"eeaRBZRpjJ"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"The Crank–Nicolson method has been implemented in","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"DrfwdrJSKP"},{"type":"break","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"Uq3czPZuYC"},{"type":"link","url":"/src/timestepper.hpp","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"timestepper.hpp","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"x25618u2Sf"}],"urlSource":"/src/timestepper.hpp","key":"OJ9ZKQxyqn"},{"type":"text","value":".","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"xTwua3Bk2a"}],"key":"UUC5LBlIy0"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"The method is defined as:","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"U8xDNWZK9N"}],"key":"IBb6auNBo4"},{"type":"math","value":"y_{i+1} = y_i + \\frac{\\tau}{2}\\big(f(t_i, y_i) + f(t_{i+1}, y_{i+1})\\big)","position":{"start":{"line":17,"column":1},"end":{"line":19,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>y</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>y</mi><mi>i</mi></msub><mo>+</mo><mfrac><mi>τ</mi><mn>2</mn></mfrac><mo fence=\"false\" stretchy=\"true\" minsize=\"1.2em\" maxsize=\"1.2em\">(</mo><mi>f</mi><mo stretchy=\"false\">(</mo><msub><mi>t</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo><mo>+</mo><mi>f</mi><mo stretchy=\"false\">(</mo><msub><mi>t</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo separator=\"true\">,</mo><msub><mi>y</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy=\"false\">)</mo><mo fence=\"false\" stretchy=\"true\" minsize=\"1.2em\" maxsize=\"1.2em\">)</mo></mrow><annotation encoding=\"application/x-tex\">y_{i+1} = y_i + \\frac{\\tau}{2}\\big(f(t_i, y_i) + f(t_{i+1}, y_{i+1})\\big)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6389em;vertical-align:-0.2083em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7778em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.7936em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.1076em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.1132em;\">τ</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mord\"><span class=\"delimsizing size1\">(</span></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.2em;vertical-align:-0.35em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mord\"><span class=\"delimsizing size1\">)</span></span></span></span></span></span>","enumerator":"1","key":"M0FzF8gBet"},{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"To achieve this, we adapted the code for the implicit and explicit Euler methods and implemented the formula above.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"fDO9eSzSGB"}],"key":"j9B3JphPUb"},{"type":"code","lang":"cpp","value":"\n  class CrankNicolson : public TimeStepper\n  {\n    std::shared_ptr<NonlinearFunction> m_equ;\n    std::shared_ptr<Parameter> m_tau_half;\n    std::shared_ptr<ConstantFunction> m_yold;\n    Vector<> m_vecf;\n    std::shared_ptr<ConstantFunction> m_fold;\n  public:\n    CrankNicolson(std::shared_ptr<NonlinearFunction> rhs) \n    : TimeStepper(rhs), m_tau_half(std::make_shared<Parameter>(0.0)) \n      , m_vecf(rhs->dimF())\n    {\n      m_yold = std::make_shared<ConstantFunction>(rhs->dimX());\n      m_fold = std::make_shared<ConstantFunction>(rhs->dimF());\n      auto ynew = std::make_shared<IdentityFunction>(rhs->dimX());\n      m_equ = m_yold + m_tau_half * (m_fold + m_rhs) - ynew;\n    }\n\n    void DoStep(double tau, VectorView<double> y) override\n    {\n      m_yold->set(y);\n      m_tau_half->set(0.5 * tau);\n\n      this->m_rhs->evaluate(y, m_vecf);\n      m_fold->set(m_vecf);\n\n      NewtonSolver(m_equ, y);\n    }\n  };","position":{"start":{"line":23,"column":1},"end":{"line":54,"column":1}},"key":"qAobihWCoA"},{"type":"heading","depth":2,"position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"children":[{"type":"text","value":"Comparison","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"zB1YuYt1RR"}],"identifier":"comparison","label":"Comparison","html_id":"comparison","implicit":true,"key":"Or2X6bV94f"},{"type":"paragraph","position":{"start":{"line":57,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"image","url":"/ASC-ODE-team04/build/mass_spring_steps_50-e12c9c2778af12594bd2ac67da38201d.png","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"lQILI2U1MV","urlSource":"Plots/mass_spring_steps_50.png"},{"type":"text","value":"\n","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"oDvWgChamE"},{"type":"image","url":"/ASC-ODE-team04/build/mass_spring_steps_10-beac97590bfbf877d7c1d01a672e6264.png","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"B4FIzZOXHg","urlSource":"Plots/mass_spring_steps_100.png"},{"type":"text","value":"\n","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"qronPYkprL"},{"type":"image","url":"/ASC-ODE-team04/build/mass_spring_steps_50-8abd88718ca40229949d2fd71329278e.png","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"kFYkIc6V9n","urlSource":"Plots/mass_spring_steps_500.png"}],"key":"KCFfbbOfOC"},{"type":"paragraph","position":{"start":{"line":61,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"text","value":"This is a simple mass–spring system, therefore the energy should be constant and the movement periodic. In state space, this would appear as a perfect ellipse. However, as we can see, this is not the case for the implicit and explicit Euler methods.","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"ZltMWXCygW"},{"type":"break","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"DWAhrzHQle"},{"type":"text","value":"The explicit method increases the speed at each step relatively quickly, and similarly, the implicit method decreases the velocity with each step, almost as if the system were damped. Both of these effects decrease with an increase in step size.","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"dKhFkTDxZ7"}],"key":"nF6ttZ6PSI"},{"type":"paragraph","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"text","value":"By far the best method in this example is the Crank–Nicolson method, as it seems to keep the energy in the system constant.","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"Cgp2TDt17z"}],"key":"kh4EH1H10D"},{"type":"heading","depth":2,"position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"text","value":"RC-Circuit","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"Z1a94b1Z6O"}],"identifier":"rc-circuit","label":"RC-Circuit","html_id":"rc-circuit","implicit":true,"key":"OOiDQDIdLB"},{"type":"paragraph","position":{"start":{"line":68,"column":1},"end":{"line":71,"column":1}},"children":[{"type":"text","value":"The RC circuit is modelled by the formula:","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"rZSyKWHaTK"}],"key":"NTHzBsN4MO"},{"type":"math","value":"U_0(t)=cos(100\\pi t)","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"tight":"before","html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>U</mi><mn>0</mn></msub><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy=\"false\">(</mo><mn>100</mn><mi>π</mi><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">U_0(t)=cos(100\\pi t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">cos</span><span class=\"mopen\">(</span><span class=\"mord\">100</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"2","key":"SMZO1GdVod"},{"type":"math","value":"U_C(t) + R C \\frac{dU_C}{dt}(t) = U_0(t)","position":{"start":{"line":73,"column":1},"end":{"line":75,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>U</mi><mi>C</mi></msub><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>R</mi><mi>C</mi><mfrac><mrow><mi>d</mi><msub><mi>U</mi><mi>C</mi></msub></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo>=</mo><msub><mi>U</mi><mn>0</mn></msub><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">U_C(t) + R C \\frac{dU_C}{dt}(t) = U_0(t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">C</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.0574em;vertical-align:-0.686em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">RC</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3714em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">t</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">C</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"3","key":"QiOAeGQ4c8"},{"type":"paragraph","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"children":[{"type":"text","value":"To bring this into an autonomous form, we treat ","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"key":"YzALxLUuhU"},{"type":"inlineMath","value":"t","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">t</span></span></span></span>","key":"UJijHTmNtN"},{"type":"text","value":" as a state variable and set","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"key":"TMxD9jHcp4"}],"key":"CbIbAzKpqe"},{"type":"math","value":"x = t.","position":{"start":{"line":79,"column":1},"end":{"line":81,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>x</mi><mo>=</mo><mi>t</mi><mi mathvariant=\"normal\">.</mi></mrow><annotation encoding=\"application/x-tex\">x = t.</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord\">.</span></span></span></span></span>","enumerator":"4","key":"eDrjfHphGh"},{"type":"paragraph","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"children":[{"type":"text","value":"Then the right-hand side becomes","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"key":"rjwGEBPOev"}],"key":"eGBDMzTo4m"},{"type":"math","value":"U_0(x) = \\cos(100\\pi x),","position":{"start":{"line":85,"column":1},"end":{"line":87,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>U</mi><mn>0</mn></msub><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>cos</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mn>100</mn><mi>π</mi><mi>x</mi><mo stretchy=\"false\">)</mo><mo separator=\"true\">,</mo></mrow><annotation encoding=\"application/x-tex\">U_0(x) = \\cos(100\\pi x),</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">cos</span><span class=\"mopen\">(</span><span class=\"mord\">100</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mpunct\">,</span></span></span></span></span>","enumerator":"5","key":"Yzt9GolnoB"},{"type":"paragraph","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"children":[{"type":"text","value":"and the ODE can be rewritten as","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"woK2myS5WQ"}],"key":"vhrr4e9xKp"},{"type":"math","value":"U_C'(t) = \\frac{\\cos(100\\pi x) - U_C(t)}{RC},","position":{"start":{"line":91,"column":1},"end":{"line":93,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msubsup><mi>U</mi><mi>C</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msubsup><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mrow><mi>cos</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mn>100</mn><mi>π</mi><mi>x</mi><mo stretchy=\"false\">)</mo><mo>−</mo><msub><mi>U</mi><mi>C</mi></msub><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><mrow><mi>R</mi><mi>C</mi></mrow></mfrac><mo separator=\"true\">,</mo></mrow><annotation encoding=\"application/x-tex\">U_C&#x27;(t) = \\frac{\\cos(100\\pi x) - U_C(t)}{RC},</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0519em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-2.453em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">C</span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.113em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.427em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">RC</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mop\">cos</span><span class=\"mopen\">(</span><span class=\"mord\">100</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">C</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mpunct\">,</span></span></span></span></span>","enumerator":"6","key":"ptAu4QgBoU"},{"type":"math","value":"x'(t) = 1.","position":{"start":{"line":95,"column":1},"end":{"line":97,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msup><mi>x</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mn>1.</mn></mrow><annotation encoding=\"application/x-tex\">x&#x27;(t) = 1.</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0519em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1.</span></span></span></span></span>","enumerator":"7","key":"E3PRiqhtCI"},{"type":"paragraph","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"This RC-Circuit was implemented as a class in ","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"alfN0L0ryN"},{"type":"link","url":"/demos/Exercise_17_4_1_RCCircuit.cpp","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"timestepper.hpp","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"FiPBQNvMvz"}],"urlSource":"/demos/Exercise_17_4_1_RCCircuit.cpp","key":"fnSPd5mOE5"}],"key":"WzqXO5qurx"},{"type":"code","lang":"cpp","value":"class RCCircuit: public NonlinearFunction\n{\nprivate:\n  double R;\n  double C;\n\npublic:\n  RCCircuit(double R_, double C_) : R(R_), C(C_) {}\n\n  size_t dimX() const override { return 2; }\n  size_t dimF() const override { return 2; }\n  \n  void evaluate (VectorView<double> x, VectorView<double> f) const override\n  {\n    double Uc = x(0);   // capacitor voltage\n    double t  = x(1);   // time\n\n    f(0) = (std::cos(100.0*t*M_PI) - Uc)/(R*C);\n    f(1) = 1.0;\n  }\n  \n  void evaluateDeriv (VectorView<double> x, MatrixView<double> df) const override\n  {\n    df = 0.0;\n    //derivatives with respect to the first state variable (Uc)\n    df(0,0) = -1.0 / (R * C);\n    df(1,0) = 0.0;\n    //derivative with respect to the second state variable (t)\n    df(0,1) = -100.0 * M_PI * std::sin(100.0 * x(1)) / (R * C);\n    df(1,1) = 0.0;\n\n  }\n};","position":{"start":{"line":101,"column":1},"end":{"line":135,"column":1}},"key":"PoaOYyTAqH"},{"type":"heading","depth":3,"position":{"start":{"line":136,"column":1},"end":{"line":136,"column":1}},"children":[{"type":"text","value":"Plots","position":{"start":{"line":136,"column":1},"end":{"line":136,"column":1}},"key":"bdu0o1fCDx"}],"identifier":"plots","label":"Plots","html_id":"plots","implicit":true,"key":"ER6M522mCw"},{"type":"paragraph","position":{"start":{"line":137,"column":1},"end":{"line":138,"column":1}},"children":[{"type":"text","value":"In the plots, one can observe a similar trend as in the mass–spring system.The explicit Euler method has too much energy, while the implicit Euler method has too little.\nHowever, unlike in the mass–spring case, both numerical solutions remain periodic, so the energy no longer grows or decays over time.","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"UuDg99IS96"}],"key":"RIiZo5njrO"},{"type":"paragraph","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"children":[{"type":"text","value":"On the left we set the parameters to R=1, C=1 and on the right R=100, C=10^-6","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"key":"RqYz8Qi6o5"}],"key":"CDKuEJ7sKJ"},{"type":"paragraph","children":[{"type":"image","url":"/ASC-ODE-team04/build/RC50stepsR1C1-1fffcd039f8401dabc754d12ec8c9a63.png","width":"45%","key":"yQVOI9kxbw","urlSource":"Plots/RC50stepsR1C1.png"},{"type":"text","value":" ","key":"agRqzbTQL7"},{"type":"image","url":"/ASC-ODE-team04/build/RC50stepsR100C-6-122a387c312a936c9db8cf81d037a489.png","width":"45%","key":"pe0TnaEGBS","urlSource":"Plots/RC50stepsR100C-6.png"}],"key":"pd17Wjmfma"},{"type":"paragraph","children":[{"type":"image","url":"/ASC-ODE-team04/build/RC100stepsR1C1-39b221e37160c9a1590ec1bdc0248123.png","width":"45%","key":"A95x3db6MK","urlSource":"Plots/RC100stepsR1C1.png"},{"type":"text","value":" ","key":"NvGRVHdmki"},{"type":"image","url":"/ASC-ODE-team04/build/RC100stepsR100C-6-83d95787b5dc5d94f9c978576c7cf68b.png","width":"45%","key":"gjzglqJJJg","urlSource":"Plots/RC100stepsR100C-6.png"}],"key":"MZNZZb4eZ9"},{"type":"paragraph","children":[{"type":"image","url":"/ASC-ODE-team04/build/RC500stepsR1C1-92c3b1cf177370d76bc872646d3964da.png","width":"45%","key":"Jq4DSM9ept","urlSource":"Plots/RC500stepsR1C1.png"},{"type":"text","value":" ","key":"XttzQnnd7h"},{"type":"image","url":"/ASC-ODE-team04/build/RC500stepsR100C-6-1968b9bde0b06eb192209a8be898df26.png","width":"45%","key":"hsZkZqcVUZ","urlSource":"Plots/RC500stepsR100C-6.png"}],"key":"drJVFIwhUK"}],"key":"aG38sTngdG"}],"key":"E4dBPGA09B"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Euler Methods","url":"/euler-methods","group":"ASC-ODE"},"next":{"title":"The Autodiff Class","url":"/autodiff","group":"ASC-ODE"}}},"domain":"http://localhost:3000"}